<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kasir Online</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0ea5e9" />

  <!-- (opsional) cegah cache HTTP -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body class="bg-light">

  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">Kasir</span>
      <a class="btn btn-sm btn-light" href="report.html">Laporan</a>
    </div>
  </nav>

  <!--
    MOBILE: semuanya ditumpuk seperti biasa (form → daftar → keranjang).
    DESKTOP: area ini diatur ulang jadi layout kasir desktop via CSS grid.
  -->
  <main id="kasir-grid" class="container py-3">
    <!-- TOTAL BESAR (desktop only, mobile disembunyikan via CSS) -->
    <section id="panel-total" class="mb-3">
      <div class="total-big shadow-sm">
        <div class="label">TOTAL</div>
        <div id="total-big" class="angka">Rp0</div>
      </div>
    </section>

    <!-- FORM PRODUK (tambah/ubah/hapus) -->
    <section id="panel-produk" class="card mb-3">
      <div class="card-header d-flex align-items-center justify-content-between">
        <strong>Kelola Produk</strong>
        <small class="text-muted">Tambah / Ubah / Hapus</small>
      </div>
      <div class="card-body">
        <form id="form-produk" class="row g-2">
          <input type="hidden" id="p-id" />
          <div class="col-12 col-md-2">
            <label class="form-label">SKU</label>
            <input id="p-sku" class="form-control" placeholder="SKU unik" required />
          </div>
          <div class="col-12 col-md-4">
            <label class="form-label">Nama</label>
            <input id="p-name" class="form-control" placeholder="Nama produk" required />
          </div>
          <div class="col-6 col-md-3">
            <label class="form-label">Harga (Rp)</label>
            <input id="p-price" type="number" min="0" step="1" class="form-control" placeholder="0" required />
          </div>
          <div class="col-6 col-md-2">
            <label class="form-label">Stok</label>
            <input id="p-stock" type="number" min="0" step="1" class="form-control" placeholder="0" required />
          </div>
          <div class="col-12 col-md-1 d-grid">
            <label class="form-label invisible">.</label>
            <button class="btn btn-primary" id="btn-save-produk" type="submit">Simpan</button>
          </div>
          <div class="col-12">
            <div id="produk-msg" class="small text-muted"></div>
          </div>
        </form>
      </div>
    </section>

    <!-- PENCARIAN -->
    <section id="panel-cari" class="mb-3">
      <div class="input-group">
        <span class="input-group-text">Cari</span>
        <input type="text" id="search" class="form-control" placeholder="Nama / SKU barang..." autofocus />
      </div>
    </section>

    <!-- DAFTAR PRODUK (render oleh app.js) -->
    <section id="panel-daftar" class="mb-3">
      <div id="product-list" class="row g-2"></div>
    </section>

    <!-- KERANJANG + TOTAL (mobile visible; desktop tetap ada untuk sinkron angka) -->
    <section id="panel-keranjang" class="mb-3">
      <h5>Keranjang</h5>
      <div id="cart-list"></div>
      <div class="d-flex justify-content-between align-items-center mt-2">
        <strong>Total: <span id="total">Rp0</span></strong>
        <button id="btn-checkout" class="btn btn-success btn-lg">Bayar</button>
      </div>
    </section>

    <!-- PANEL AKSI KANAN (desktop only): tombol bayar besar + catatan/metode singkat -->
    <aside id="panel-aksi" class="d-none d-lg-block">
      <div class="card sticky-top" style="top: 92px">
        <div class="card-body d-grid gap-2">
          <button id="btn-checkout-desktop" class="btn btn-success btn-lg">Bayar (Enter)</button>
          <div class="small text-muted">
            Tips: tekan <kbd>/</kbd> untuk fokus pencarian, <kbd>Enter</kbd> untuk bayar.
          </div>
        </div>
      </div>
    </aside>
  </main>

  <!-- MODAL CHECKOUT (dipakai HP & desktop) -->
  <div class="modal fade" id="checkoutModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Pembayaran</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Metode</label>
            <select id="payment" class="form-select">
              <option value="cash">Cash</option>
              <option value="qris">QRIS</option>
              <option value="transfer">Transfer</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Catatan</label>
            <input id="note" class="form-control" placeholder="Opsional" />
          </div>
          <div class="mb-3">
            <label class="form-label">Nominal Bayar</label>
            <input id="payAmount" type="number" min="0" class="form-control" placeholder="Masukkan jumlah uang diterima" />
          </div>
          <div class="text-end small">Kembali: <strong id="change-label">Rp0</strong></div>
          <p class="text-end mb-0">Total: <strong id="modal-total">Rp0</strong></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          <button id="confirm-pay" type="button" class="btn btn-primary">Konfirmasi Bayar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
  <script src="assets/js/app.js" defer></script>

  <!-- Sinkron angka TOTAL ke “total-big” & tombol bayar desktop -->
  <script>
    (function () {
      const big = document.getElementById('total-big');
      const small = document.getElementById('total');
      const mo = new MutationObserver(() => big && small && (big.textContent = small.textContent));
      if (small) mo.observe(small, { childList: true, subtree: true, characterData: true });
      // tombol bayar (desktop) memicu tombol bayar standar
      const bd = document.getElementById('btn-checkout-desktop');
      const bm = document.getElementById('btn-checkout');
      bd && bm && bd.addEventListener('click', () => bm.click());
      // shortcut: / untuk fokus search, Enter untuk bayar
      document.addEventListener('keydown', (e) => {
        if (e.key === '/' && !/input|textarea|select/i.test(e.target.tagName)) {
          e.preventDefault(); document.getElementById('search')?.focus();
        } else if (e.key === 'Enter' && !/input|textarea|select/i.test(e.target.tagName)) {
          document.getElementById('btn-checkout')?.click();
        }
      });
    })();
  </script>

  <!-- Service Worker tetap -->
  <script>
    if ('serviceWorker' in navigator) {
      (async () => {
        try {
          const reg = await navigator.serviceWorker.register('/sw.js.php', { scope: '/' });
          reg.update(); setInterval(() => reg.update(), 30000);
          let reloaded = false;
          navigator.serviceWorker.addEventListener('controllerchange', () => {
            if (reloaded) return; reloaded = true; location.reload();
          });
        } catch (err) {
          console.warn('SW register failed:', err);
        }
      })();
    }
  </script>
</body>
</html>
