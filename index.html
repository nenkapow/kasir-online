<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kasir Warung Alesha</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0ea5e9" />

  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body class="bg-light">

<!-- NAVBAR -->
<nav class="navbar navbar-dark bg-primary sticky-top">
  <div class="container-fluid">
    <span class="navbar-brand">Kasir</span>
    <div class="d-flex gap-2">
      <a class="btn btn-sm btn-light" href="purchases.html">Pembelian</a>
      <button id="btn-open-products" class="btn btn-sm btn-outline-light">Kelola Produk</button>
      <a class="btn btn-sm btn-light" href="report.html">Laporan</a>
    </div>
  </div>
</nav>

<main class="container-fluid py-3" style="max-width:1100px">
  <!-- TOTAL BESAR -->
  <div class="total-box shadow-sm mb-3 px-3 py-2 d-flex justify-content-between align-items-center rounded">
    <div class="text-muted small">TOTAL</div>
    <div id="grand-total" class="display-6 fw-bold m-0">Rp 0</div>
  </div>

  <!-- INPUT BAR -->
  <div class="row g-2 align-items-end mb-3">
    <div class="col-12 col-md-8">
      <label class="form-label mb-1">Scan / Cari Produk (SKU atau Nama)</label>
      <input id="search" class="form-control form-control-lg" placeholder="Contoh: RK0001 / Indomie…" autocomplete="off">
      <div id="suggest" class="list-group shadow-sm mt-1 d-none"></div>
    </div>
    <div class="col-6 col-md-2">
      <label class="form-label mb-1">Qty</label>
      <input id="qty" type="number" min="1" step="1" class="form-control form-control-lg" value="1">
    </div>
    <div class="col-6 col-md-2 d-grid">
      <button id="add-btn" class="btn btn-primary btn-lg">Tambah (Enter)</button>
    </div>
  </div>

  <!-- TABEL TRANSAKSI -->
  <div class="table-responsive shadow-sm rounded bg-white">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th style="width:120px">SKU</th>
          <th>Item</th>
          <th class="text-end" style="width:140px">Harga</th>
          <th class="text-center" style="width:160px">Banyak</th>
          <th class="text-end" style="width:160px">Subtotal</th>
          <th style="width:60px"></th>
        </tr>
      </thead>
      <tbody id="lines"></tbody>
    </table>
  </div>

  <!-- PANEL BAYAR -->
  <div class="row g-3 mt-3">
    <div class="col-12 col-md-6">
      <label class="form-label">Catatan (opsional)</label>
      <input id="note" class="form-control" placeholder="Catatan pesanan…">
    </div>
    <div class="col-6 col-md-3">
      <label class="form-label">Nominal Bayar</label>
      <input id="pay" type="number" min="0" step="1" class="form-control" placeholder="0">
    </div>
    <div class="col-6 col-md-3">
      <label class="form-label">Kembali</label>
      <input id="change" class="form-control" value="Rp 0" readonly>
    </div>
  </div>

  <div class="d-flex gap-2 mt-3 flex-wrap">
    <select id="method" class="form-select" style="max-width:200px">
      <option value="cash">Cash</option>
      <option value="qris">QRIS</option>
      <option value="transfer">Transfer</option>
    </select>
    <button id="clear-btn" class="btn btn-outline-secondary">Bersihkan (Esc)</button>
    <button id="pay-btn" class="btn btn-success ms-auto btn-lg">Bayar (Ctrl+B)</button>
  </div>

  <!-- FOOTER BAR HP -->
  <div id="mobile-bar" class="mobile-bar d-md-none">
    <div><small>Total</small><div id="mb-total" class="fw-bold">Rp 0</div></div>
    <button id="mb-pay" class="btn btn-success btn-lg flex-grow-1">Bayar</button>
  </div>
</main>

<!-- ================ MODAL KELOLA PRODUK ================ -->
<div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Kelola Produk</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
      </div>
      <div class="modal-body">
        <form id="prod-form" class="row g-2 mb-3">
          <input type="hidden" id="prod-id">
          <div class="col-6 col-md-3">
            <label class="form-label">SKU</label>
            <input id="prod-sku" class="form-control" required>
          </div>
          <div class="col-12 col-md-5">
            <label class="form-label">Nama</label>
            <input id="prod-name" class="form-control" required>
          </div>
          <div class="col-6 col-md-2">
            <label class="form-label">Harga Jual (Rp)</label>
            <input id="prod-price" type="number" min="0" step="1" class="form-control" value="0" required>
          </div>
          <div class="col-6 col-md-2">
            <label class="form-label">Modal (Rp)</label>
            <input id="prod-cost" class="form-control" value="0" readonly>
          </div>
          <div class="col-6 col-md-2">
            <label class="form-label">Stok</label>
            <input id="prod-stock" type="number" class="form-control" value="0" disabled>
          </div>
          <div class="col-12 d-flex gap-2">
            <button class="btn btn-primary" type="submit">Simpan</button>
            <button id="prod-reset" class="btn btn-outline-secondary" type="button">Baru</button>
          </div>
        </form>

        <div class="input-group mb-2">
          <span class="input-group-text">Cari</span>
          <input id="prod-search" class="form-control" placeholder="Nama / SKU…">
        </div>

        <div class="table-responsive">
          <table class="table table-sm align-middle">
            <thead class="table-light">
              <tr>
                <th style="width:120px">SKU</th>
                <th>Nama</th>
                <th class="text-end" style="width:120px">Harga Jual</th>
                <th class="text-end" style="width:120px">Modal</th>
                <th class="text-center" style="width:120px">Stok</th>
                <th style="width:160px"></th>
              </tr>
            </thead>
            <tbody id="prod-rows"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- ================= /MODAL KELOLA PRODUK ================= -->

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
<script src="assets/js/app.js" defer></script>

<!-- Service Worker (auto update) -->
<script>
if ('serviceWorker' in navigator) {
  (async () => {
    try {
      const reg = await navigator.serviceWorker.register('/sw.js.php', { scope:'/' });
      reg.update();
      setInterval(()=>reg.update(), 30000);
      let once=false;
      navigator.serviceWorker.addEventListener('controllerchange',()=>{ if(!once){once=true; location.reload();}});
    } catch(e){ console.warn(e); }
  })();
}
</script>
</body>
</html>
